<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Attestia.App.Pages.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Loaded="Page_Loaded">

    <ScrollViewer>
        <StackPanel Padding="32,28,32,32" Spacing="20" MaxWidth="1100">

            <!-- Header -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <FontIcon Glyph="&#xE80F;" FontSize="24"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    <TextBlock Text="Dashboard" FontSize="28" FontWeight="SemiBold" />
                </StackPanel>
                <Button Grid.Column="1" Content="Refresh" Click="Refresh_Click" />
            </Grid>

            <!-- Engine Offline Banner -->
            <Grid x:Name="OfflineBanner" Visibility="Collapsed"
                  Padding="20" CornerRadius="8"
                  Background="{ThemeResource SystemFillColorCautionBackgroundBrush}"
                  BorderBrush="{ThemeResource SystemFillColorCautionBrush}"
                  BorderThickness="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <FontIcon Glyph="&#xE7BA;" FontSize="24" Margin="0,0,16,0"
                          VerticalAlignment="Center" />
                <StackPanel Grid.Column="1" Spacing="4" VerticalAlignment="Center">
                    <TextBlock Text="Attestation engine offline" FontWeight="SemiBold" FontSize="14" />
                    <TextBlock Text="Live data requires the engine to be running. Check Settings to start it."
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13"
                               TextWrapping="Wrap" />
                </StackPanel>
                <Button Grid.Column="2" Content="Retry" Click="Refresh_Click"
                        VerticalAlignment="Center" Margin="16,0,0,0" />
            </Grid>

            <!-- Getting Started (first-run) -->
            <Grid x:Name="GettingStartedCard" Visibility="Collapsed"
                  Padding="24" CornerRadius="8"
                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                  BorderBrush="{ThemeResource AccentFillColorDefaultBrush}"
                  BorderThickness="1">
                <StackPanel Spacing="16">
                    <TextBlock Text="Welcome to Attestia" FontSize="20" FontWeight="SemiBold" />
                    <TextBlock TextWrapping="Wrap" FontSize="13" LineHeight="20"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Text="Attestia provides verifiable financial truth. Every transaction is declared as an intent, reconciled against your ledger and on-chain activity, then cryptographically attested." />

                    <Grid ColumnSpacing="16" RowSpacing="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" Grid.Column="0" Width="28" Height="28" CornerRadius="14"
                                Background="{ThemeResource AccentFillColorDefaultBrush}"
                                HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="1" FontSize="13" FontWeight="SemiBold"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}" />
                        </Border>
                        <TextBlock Grid.Row="0" Grid.Column="1" VerticalAlignment="Center"
                                   Text="Start the attestation engine from Settings" FontSize="13" />

                        <Border Grid.Row="1" Grid.Column="0" Width="28" Height="28" CornerRadius="14"
                                Background="{ThemeResource AccentFillColorDefaultBrush}"
                                HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="2" FontSize="13" FontWeight="SemiBold"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}" />
                        </Border>
                        <TextBlock Grid.Row="1" Grid.Column="1" VerticalAlignment="Center"
                                   Text="Declare your first financial intent" FontSize="13" />

                        <Border Grid.Row="2" Grid.Column="0" Width="28" Height="28" CornerRadius="14"
                                Background="{ThemeResource AccentFillColorDefaultBrush}"
                                HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="3" FontSize="13" FontWeight="SemiBold"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}" />
                        </Border>
                        <TextBlock Grid.Row="2" Grid.Column="1" VerticalAlignment="Center"
                                   Text="Run reconciliation to generate your first proof" FontSize="13" />
                    </Grid>
                </StackPanel>
            </Grid>

            <!-- System Health -->
            <StackPanel Spacing="8">
                <TextBlock Text="System Health" FontSize="16" FontWeight="SemiBold" />
                <Grid ColumnSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Engine -->
                    <Grid Grid.Column="0" Padding="20" CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          BorderThickness="1">
                        <StackPanel Spacing="6">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Ellipse x:Name="EngineIndicator" Width="8" Height="8"
                                         Fill="Gray" VerticalAlignment="Center" />
                                <TextBlock Text="Engine" FontSize="12"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            </StackPanel>
                            <TextBlock x:Name="EngineStatusText" Text="..." FontSize="14" FontWeight="SemiBold" />
                        </StackPanel>
                    </Grid>

                    <!-- Ledger -->
                    <Grid Grid.Column="1" Padding="20" CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          BorderThickness="1">
                        <ToolTipService.ToolTip>
                            <ToolTip Content="The number of financial intents tracked by the system." />
                        </ToolTipService.ToolTip>
                        <StackPanel Spacing="6">
                            <TextBlock Text="Intents Tracked" FontSize="12"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <TextBlock x:Name="IntentCountText" Text="—" FontSize="28" FontWeight="Bold" />
                        </StackPanel>
                    </Grid>

                    <!-- Integrity -->
                    <Grid Grid.Column="2" Padding="20" CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          BorderThickness="1">
                        <ToolTipService.ToolTip>
                            <ToolTip Content="Entries in the tamper-evident Merkle tree that secures all attestations." />
                        </ToolTipService.ToolTip>
                        <StackPanel Spacing="6">
                            <TextBlock Text="Proof Entries" FontSize="12"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <TextBlock x:Name="LeafCountText" Text="—" FontSize="28" FontWeight="Bold" />
                        </StackPanel>
                    </Grid>

                    <!-- Governance -->
                    <Grid Grid.Column="3" Padding="20" CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          BorderThickness="1">
                        <ToolTipService.ToolTip>
                            <ToolTip Content="The most recent reconciliation attestation produced by the system." />
                        </ToolTipService.ToolTip>
                        <StackPanel Spacing="6">
                            <TextBlock Text="Latest Attestation" FontSize="12"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <TextBlock x:Name="AttestationText" Text="—" FontSize="14" FontWeight="SemiBold"
                                       TextTrimming="CharacterEllipsis" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </StackPanel>

            <!-- Integrity Root -->
            <Grid Padding="20" CornerRadius="8"
                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                  BorderThickness="1">
                <ToolTipService.ToolTip>
                    <ToolTip Content="The Merkle root is a single hash that represents the integrity of all attestation records." />
                </ToolTipService.ToolTip>
                <StackPanel Spacing="6">
                    <TextBlock Text="Integrity Root" FontSize="12"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    <TextBlock x:Name="MerkleRootText" Text="—" FontFamily="Consolas" FontSize="13"
                               IsTextSelectionEnabled="True" TextWrapping="Wrap"
                               Foreground="{ThemeResource TextFillColorPrimaryBrush}" />
                </StackPanel>
            </Grid>

            <!-- Loading -->
            <ProgressRing x:Name="LoadingRing" IsActive="False" Width="24" Height="24"
                          HorizontalAlignment="Left" />
        </StackPanel>
    </ScrollViewer>
</Page>
