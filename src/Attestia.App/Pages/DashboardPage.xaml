<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Attestia.App.Pages.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Loaded="Page_Loaded">

    <ScrollViewer>
        <StackPanel Padding="32,28,32,32" Spacing="24" MaxWidth="1100">

            <!-- Header with Declare Intent CTA -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <StackPanel Spacing="4">
                    <TextBlock Text="System Overview" FontSize="28" FontWeight="SemiBold" />
                    <TextBlock Text="Deterministic financial integrity at a glance."
                               FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8"
                            VerticalAlignment="Top">
                    <Button x:Name="DeclareIntentBtn" Content="Declare Intent" Click="DeclareIntent_Click"
                            Background="{StaticResource AttestiaAccentBrush}"
                            Foreground="{StaticResource AttestiaPrimaryBackgroundBrush}"
                            FontWeight="SemiBold" />
                    <Button Content="Recalculate State" Click="Refresh_Click"
                            FontSize="12" Padding="8,4" />
                </StackPanel>
            </Grid>

            <!-- Engine Offline Banner -->
            <Grid x:Name="OfflineBanner" Visibility="Collapsed"
                  Padding="20" CornerRadius="8"
                  Background="{ThemeResource SystemFillColorCautionBackgroundBrush}"
                  BorderBrush="{ThemeResource SystemFillColorCautionBrush}"
                  BorderThickness="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <FontIcon Glyph="&#xE7BA;" FontSize="24" Margin="0,0,16,0"
                          VerticalAlignment="Center" />
                <StackPanel Grid.Column="1" Spacing="4" VerticalAlignment="Center">
                    <TextBlock Text="Attestation engine offline" FontWeight="SemiBold" FontSize="14" />
                    <TextBlock Text="System integrity cannot be verified while the engine is unavailable. Navigate to Settings to restore operation."
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="13"
                               TextWrapping="Wrap" />
                </StackPanel>
                <Button Grid.Column="2" Content="Reattempt Connection" Click="Refresh_Click"
                        VerticalAlignment="Center" Margin="16,0,0,0" FontSize="12" Padding="8,4" />
            </Grid>

            <!-- Getting Started (first-run) -->
            <Grid x:Name="GettingStartedCard" Visibility="Collapsed"
                  Padding="24" CornerRadius="8"
                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                  BorderBrush="{StaticResource AttestiaAccentBrush}"
                  BorderThickness="1">
                <StackPanel Spacing="16">
                    <TextBlock Text="Initialize Your Attestation System" FontSize="20" FontWeight="SemiBold" />
                    <TextBlock TextWrapping="Wrap" FontSize="14" LineHeight="22"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Text="Attestia provides deterministic financial integrity. Every transaction is declared as an intent, reconciled against your ledger and on-chain activity, then cryptographically attested and archived." />

                    <Grid ColumnSpacing="16" RowSpacing="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" Grid.Column="0" Width="28" Height="28" CornerRadius="14"
                                Background="{StaticResource AttestiaAccentBrush}"
                                HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="1" FontSize="13" FontWeight="SemiBold"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Foreground="{StaticResource AttestiaPrimaryBackgroundBrush}" />
                        </Border>
                        <TextBlock Grid.Row="0" Grid.Column="1" VerticalAlignment="Center"
                                   Text="Start the attestation engine from Settings" FontSize="14" />

                        <Border Grid.Row="1" Grid.Column="0" Width="28" Height="28" CornerRadius="14"
                                Background="{StaticResource AttestiaAccentBrush}"
                                HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="2" FontSize="13" FontWeight="SemiBold"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Foreground="{StaticResource AttestiaPrimaryBackgroundBrush}" />
                        </Border>
                        <TextBlock Grid.Row="1" Grid.Column="1" VerticalAlignment="Center"
                                   Text="Declare your first financial intent" FontSize="14" />

                        <Border Grid.Row="2" Grid.Column="0" Width="28" Height="28" CornerRadius="14"
                                Background="{StaticResource AttestiaAccentBrush}"
                                HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="3" FontSize="13" FontWeight="SemiBold"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Foreground="{StaticResource AttestiaPrimaryBackgroundBrush}" />
                        </Border>
                        <TextBlock Grid.Row="2" Grid.Column="1" VerticalAlignment="Center"
                                   Text="Execute reconciliation to generate your first attestation proof" FontSize="14" />
                    </Grid>
                </StackPanel>
            </Grid>

            <!-- Integrity Status Panel (4-card grid) -->
            <StackPanel Spacing="8">
                <TextBlock Text="System Integrity" FontSize="18" FontWeight="SemiBold" />
                <Grid ColumnSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Ledger Status -->
                    <Grid Grid.Column="0" Padding="16" CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          BorderThickness="1">
                        <StackPanel Spacing="6">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8FD;" FontSize="12"
                                          Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                                <TextBlock Text="Ledger" FontSize="12"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            </StackPanel>
                            <TextBlock x:Name="LedgerStatusText" Text="Append-Only" FontSize="13" FontWeight="SemiBold" />
                            <TextBlock x:Name="LedgerStatusDetail" Text="Event integrity verified" FontSize="11"
                                       Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                        </StackPanel>
                    </Grid>

                    <!-- Governance Status -->
                    <Grid Grid.Column="1" Padding="16" CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          BorderThickness="1">
                        <StackPanel Spacing="6">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8A7;" FontSize="12"
                                          Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                                <TextBlock Text="Governance" FontSize="12"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            </StackPanel>
                            <TextBlock x:Name="GovernanceStatusText" Text="Active" FontSize="13" FontWeight="SemiBold" />
                            <TextBlock x:Name="GovernanceStatusDetail" Text="Intent approval required" FontSize="11"
                                       Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                        </StackPanel>
                    </Grid>

                    <!-- Witness Quorum -->
                    <Grid Grid.Column="2" Padding="16" CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          BorderThickness="1">
                        <StackPanel Spacing="6">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE716;" FontSize="12"
                                          Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                                <TextBlock Text="Witness Quorum" FontSize="12"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            </StackPanel>
                            <TextBlock x:Name="QuorumStatusText" Text="Pending" FontSize="13" FontWeight="SemiBold" />
                            <TextBlock x:Name="QuorumStatusDetail" Text="No witnesses registered" FontSize="11"
                                       Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                        </StackPanel>
                    </Grid>

                    <!-- Integrity Root -->
                    <Grid Grid.Column="3" Padding="16" CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          BorderThickness="1">
                        <StackPanel Spacing="6">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE72E;" FontSize="12"
                                          Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                                <TextBlock Text="Integrity Root" FontSize="12"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            </StackPanel>
                            <TextBlock x:Name="IntegrityRootStatusText" Text="Not Computed" FontSize="13" FontWeight="SemiBold" />
                            <TextBlock x:Name="IntegrityRootStatusDetail" Text="Awaiting first attestation" FontSize="11"
                                       Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </StackPanel>

            <!-- Financial Truth Pipeline -->
            <StackPanel Spacing="8">
                <TextBlock Text="Attestation Pipeline" FontSize="18" FontWeight="SemiBold" />
                <TextBlock Text="Each financial action flows through five deterministic stages from declaration to compliance."
                           FontSize="13" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                <Grid ColumnSpacing="8" Margin="0,8,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Stage 1: Intent -->
                    <Grid Grid.Column="0" Padding="16" CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{StaticResource PipelineIntentBrush}"
                          BorderThickness="0,2,0,0">
                        <StackPanel Spacing="6">
                            <TextBlock Text="Intent" FontSize="12" FontWeight="SemiBold"
                                       Foreground="{StaticResource PipelineIntentBrush}" />
                            <TextBlock x:Name="PipelineIntentCount" Text="—" FontSize="24" FontWeight="Bold" />
                            <TextBlock Text="Declared" FontSize="11"
                                       Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                        </StackPanel>
                    </Grid>

                    <FontIcon Grid.Column="1" Glyph="&#xE76C;" FontSize="14"
                              Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                              VerticalAlignment="Center" />

                    <!-- Stage 2: Attested -->
                    <Grid Grid.Column="2" Padding="16" CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{StaticResource PipelineAttestedBrush}"
                          BorderThickness="0,2,0,0">
                        <StackPanel Spacing="6">
                            <TextBlock Text="Attested" FontSize="12" FontWeight="SemiBold"
                                       Foreground="{StaticResource PipelineAttestedBrush}" />
                            <TextBlock x:Name="PipelineAttestedCount" Text="—" FontSize="24" FontWeight="Bold" />
                            <TextBlock Text="Records" FontSize="11"
                                       Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                        </StackPanel>
                    </Grid>

                    <FontIcon Grid.Column="3" Glyph="&#xE76C;" FontSize="14"
                              Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                              VerticalAlignment="Center" />

                    <!-- Stage 3: Reconciled -->
                    <Grid Grid.Column="4" Padding="16" CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{StaticResource PipelineReconciledBrush}"
                          BorderThickness="0,2,0,0">
                        <StackPanel Spacing="6">
                            <TextBlock Text="Reconciled" FontSize="12" FontWeight="SemiBold"
                                       Foreground="{StaticResource PipelineReconciledBrush}" />
                            <TextBlock x:Name="PipelineReconciledText" Text="—" FontSize="14" FontWeight="SemiBold" />
                            <TextBlock Text="Latest match" FontSize="11"
                                       Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                        </StackPanel>
                    </Grid>

                    <FontIcon Grid.Column="5" Glyph="&#xE76C;" FontSize="14"
                              Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                              VerticalAlignment="Center" />

                    <!-- Stage 4: Proven -->
                    <Grid Grid.Column="6" Padding="16" CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{StaticResource PipelineProvenBrush}"
                          BorderThickness="0,2,0,0">
                        <StackPanel Spacing="6">
                            <TextBlock Text="Proven" FontSize="12" FontWeight="SemiBold"
                                       Foreground="{StaticResource PipelineProvenBrush}" />
                            <TextBlock x:Name="PipelineProofCount" Text="—" FontSize="24" FontWeight="Bold" />
                            <TextBlock Text="Merkle entries" FontSize="11"
                                       Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                        </StackPanel>
                    </Grid>

                    <FontIcon Grid.Column="7" Glyph="&#xE76C;" FontSize="14"
                              Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                              VerticalAlignment="Center" />

                    <!-- Stage 5: Compliant -->
                    <Grid Grid.Column="8" Padding="16" CornerRadius="8"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{StaticResource PipelineCompliantBrush}"
                          BorderThickness="0,2,0,0">
                        <StackPanel Spacing="6">
                            <TextBlock Text="Compliant" FontSize="12" FontWeight="SemiBold"
                                       Foreground="{StaticResource PipelineCompliantBrush}" />
                            <TextBlock x:Name="PipelineCompliantText" Text="—" FontSize="14" FontWeight="SemiBold" />
                            <TextBlock Text="Frameworks" FontSize="11"
                                       Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </StackPanel>

            <!-- Engine Status + Integrity Anchor (side by side) -->
            <Grid ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Engine Status -->
                <Grid Grid.Column="0" Padding="20" CornerRadius="8"
                      Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                      BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                      BorderThickness="1">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Attestation Engine" FontSize="14" FontWeight="SemiBold" />
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <Ellipse x:Name="EngineIndicator" Width="10" Height="10"
                                     Fill="Gray" VerticalAlignment="Center" />
                            <TextBlock x:Name="EngineStatusText" Text="..." FontSize="16" FontWeight="SemiBold" />
                        </StackPanel>
                        <TextBlock x:Name="LastVerifiedText" Text="" FontSize="11"
                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                    </StackPanel>
                </Grid>

                <!-- Integrity Anchor -->
                <Grid Grid.Column="1" Padding="20" CornerRadius="8"
                      Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                      BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                      BorderThickness="1">
                    <StackPanel Spacing="8">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE72E;" FontSize="14"
                                      Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            <TextBlock Text="Integrity Anchor" FontSize="14" FontWeight="SemiBold" />
                            <Border x:Name="IntegrityBadge" Padding="6,2" CornerRadius="4"
                                    Background="{StaticResource AttestiaHealthyBrush}" Visibility="Collapsed">
                                <TextBlock Text="Verified" FontSize="10" FontWeight="SemiBold"
                                           Foreground="{StaticResource AttestiaPrimaryTextBrush}" />
                            </Border>
                        </StackPanel>
                        <TextBlock x:Name="MerkleRootText" Text="Not yet computed" FontFamily="Consolas" FontSize="12"
                                   IsTextSelectionEnabled="True" TextWrapping="Wrap"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" MaxLines="2"
                                   TextTrimming="CharacterEllipsis" />
                        <StackPanel Orientation="Horizontal" Spacing="16">
                            <TextBlock FontSize="12" Foreground="{ThemeResource TextFillColorTertiaryBrush}">
                                <Run Text="Proof entries: " />
                                <Run x:Name="IntegrityLeafCount" Text="0" FontWeight="SemiBold" />
                            </TextBlock>
                        </StackPanel>
                        <TextBlock Text="This root is immutable. Any modification to the attestation record will produce a different hash."
                                   FontSize="11" Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                   TextWrapping="Wrap" FontStyle="Italic" />
                    </StackPanel>
                </Grid>
            </Grid>

            <!-- Loading -->
            <ProgressRing x:Name="LoadingRing" IsActive="False" Width="24" Height="24"
                          HorizontalAlignment="Left" />
        </StackPanel>
    </ScrollViewer>
</Page>
